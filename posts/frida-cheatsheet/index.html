<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="trib0r3 ">
<meta name="description" content="" />
<meta name="keywords" content="reverse-engineerns, re, asm, C&#43;&#43;, programming, tools/binary-analysis, cheatsheet, frida" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/frida-cheatsheet/" />


    <title>
        
            Frida Cheatsheet :: trib0r3&#39;s blog  — Make reversing fun again!
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.753fac8f03736f0edc9be411eb20cee875dd7bb8e73c8155fbf6a629c863f4ca.css">


    
        <link rel="stylesheet" type="text/css" href="/style.css">
    





<meta itemprop="name" content="Frida Cheatsheet">
<meta itemprop="description" content="">
<meta itemprop="datePublished" content="2020-07-26T15:25:42+02:00" />
<meta itemprop="dateModified" content="2020-07-26T15:25:42+02:00" />
<meta itemprop="wordCount" content="724">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="tools/binary-analysis,cheatsheet,frida," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Frida Cheatsheet"/>
<meta name="twitter:description" content=""/>







    <meta property="article:published_time" content="2020-07-26 15:25:42 &#43;0200 CEST" />







<meta name="google-site-verification" content="Bf1vRw0a3PdL80fr1mxdlmaJbpLwHdliGy9r3w2Qaec" />
<meta property="og:title" content="Frida Cheatsheet" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/frida-cheatsheet/" />
<meta property="og:image" content="/"/>
<meta property="article:published_time" content="2020-07-26T15:25:42+02:00" />
<meta property="article:modified_time" content="2020-07-26T15:25:42+02:00" /><meta property="og:site_name" content="trib0r3&#39;s blog" />


    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">trib0r3&#39;s blog</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/tags">#tags</a></li><li><a href="/about">About</a></li><li><a href="/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="/posts/frida-cheatsheet/">Frida Cheatsheet</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#quick-start">Quick Start</a></li>
    <li><a href="#default-stuff">Default stuff</a></li>
    <li><a href="#code-snippets">Code snippets:</a></li>
    <li><a href="#useful-api-calls">Useful API calls</a>
      <ul>
        <li><a href="#debugging">Debugging</a></li>
        <li><a href="#enumerate-binary">Enumerate binary</a></li>
        <li><a href="#resolving-libsfuncs-location">Resolving libs/funcs location</a></li>
      </ul>
    </li>
    <li><a href="#script-communication">Script Communication</a>
      <ul>
        <li><a href="#rpc">RPC</a></li>
      </ul>
    </li>
    <li><a href="#reuse-the-binary-code">Reuse the binary code</a></li>
    <li><a href="#function-hooking">Function Hooking</a>
      <ul>
        <li><a href="#by-symbol">By symbol</a></li>
        <li><a href="#by-symbol-1">By symbol</a></li>
      </ul>
    </li>
    <li><a href="#remote-execution-debugging">Remote execution (debugging)</a></li>
    <li><a href="#tools">Tools</a>
      <ul>
        <li><a href="#frida-cli">frida CLI</a></li>
        <li><a href="#frida-server-remote">frida-server (remote)</a></li>
        <li><a href="#frida-gadget-remote">frida-gadget (remote)</a></li>
        <li><a href="#frida-trace">frida-trace</a></li>
      </ul>
    </li>
    <li><a href="#examples">Examples</a>
      <ul>
        <li><a href="#spawn-web-server">Spawn web server</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
                </aside>
                <hr />

            

            <div class="post-content">
                <blockquote>
<p>Notes are mostly based on the <a href="#references">frida-boot</a> labs.</p>
</blockquote>
<h2 id="quick-start">Quick Start</h2>
<p>Frida project quick start:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/trib0r3/frida-scripts
</code></pre></div><h2 id="default-stuff">Default stuff</h2>
<ul>
<li>remote port: <code>27042</code></li>
</ul>
<h2 id="code-snippets">Code snippets:</h2>
<ul>
<li><a href="https://github.com/iddoeldor/frida-snippets">GitHub - iddoeldor/frida-snippets: Hand-crafted Frida examples</a></li>
<li><a href="https://codeshare.frida.re/">https://codeshare.frida.re/</a></li>
</ul>
<h2 id="useful-api-calls">Useful API calls</h2>
<h3 id="debugging">Debugging</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">// print local environment (variables)
</span><span style="color:#75715e"></span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>, <span style="color:#66d9ef">null</span>, <span style="color:#ae81ff">4</span>))
</code></pre></div><h3 id="enumerate-binary">Enumerate binary</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">// list loaded libraries
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Process</span>.<span style="color:#a6e22e">enumerateModulesSync</span>();

<span style="color:#75715e">// list functions of the library
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Process</span>.<span style="color:#a6e22e">getModuleByName</span>(<span style="color:#e6db74">&#34;libc-2.30.so&#34;</span>).<span style="color:#a6e22e">enumerateExports</span>();
</code></pre></div><h3 id="resolving-libsfuncs-location">Resolving libs/funcs location</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">// get reference to library
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Process</span>.<span style="color:#a6e22e">getModuleByName</span>(<span style="color:#e6db74">&#34;libc-2.30.so&#34;</span>);

<span style="color:#75715e">// Retrieve from symbols
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Module</span>.<span style="color:#a6e22e">getExportByName</span>(<span style="color:#75715e">/* libname or */</span> <span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#34;sleep&#34;</span>);
<span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;sleep&#34;</span>);

<span style="color:#75715e">// Calculate based on offset
</span><span style="color:#75715e"></span><span style="color:#a6e22e">Module</span>.<span style="color:#a6e22e">getBaseAddress</span>(<span style="color:#e6db74">&#34;libc-2.30.so&#34;</span>).<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;0xcad90&#34;</span>);
<span style="color:#e6db74">&#34;0x7fc2edc42d90&#34;</span>
</code></pre></div><h2 id="script-communication">Script Communication</h2>
<ol>
<li>via <code>recv</code> and <code>send</code></li>
<li>via RPC
<ul>
<li>you can provide arguments and receive the return values</li>
<li>whole logic can be held in python, only binary operations are in JS</li>
</ul>
</li>
</ol>
<h3 id="rpc">RPC</h3>
<ul>
<li>TypeScript
<ol>
<li>Get reference to the function</li>
<li>Create it prototype</li>
<li>Make them python-accessible by adding them to the <code>rpc.exports</code> dictionary.</li>
</ol>
</li>
<li>Python
<ol>
<li>Reference functions with <code>script.exports.&lt;func_name&gt;()</code></li>
</ol>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPinPtr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;test_pin&#34;</span>);
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NativeFunction</span>(<span style="color:#a6e22e">testPinPtr</span>, <span style="color:#e6db74">&#34;int&#34;</span>, [<span style="color:#e6db74">&#34;pointer&#34;</span>]);

<span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> { <span style="color:#75715e">// defince accessible funcs from python
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">testPin</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">p</span>) {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#a6e22e">allocUtf8String</span>(<span style="color:#a6e22e">p</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">testPin</span>(<span style="color:#a6e22e">pin</span>);
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> frida
<span style="color:#f92672">import</span> sys

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;index.js&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> f:
    agent <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()

session <span style="color:#f92672">=</span> frida<span style="color:#f92672">.</span>attach(<span style="color:#e6db74">&#34;crypt&#34;</span>)
script <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>create_script(agent)
script<span style="color:#f92672">.</span>load()

api <span style="color:#f92672">=</span> script<span style="color:#f92672">.</span>exports <span style="color:#75715e"># ref to funcs from js</span>

<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">9999</span>):
    res <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>test_pin(str(x))
    <span style="color:#66d9ef">if</span> res <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        <span style="color:#66d9ef">continue</span>

    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;Pin: {x}&#34;</span>)
    <span style="color:#66d9ef">break</span>

</code></pre></div><h2 id="reuse-the-binary-code">Reuse the binary code</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// get addr
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPinPtr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;test_pin&#34;</span>);

<span style="color:#75715e">// create JS wrapper
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NativeFunction</span>(<span style="color:#a6e22e">testPinPtr</span>, <span style="color:#e6db74">&#34;int&#34;</span>, [<span style="color:#e6db74">&#34;pointer&#34;</span>]);


<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">9999</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Trying: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#a6e22e">allocUtf8String</span>(<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPin</span>(<span style="color:#a6e22e">pin</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Pin is: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
        <span style="color:#66d9ef">break</span>;
    }
}
</code></pre></div><h2 id="function-hooking">Function Hooking</h2>
<h3 id="by-symbol">By symbol</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> __future__ <span style="color:#f92672">import</span> print_function
<span style="color:#f92672">import</span> frida
<span style="color:#f92672">import</span> sys

session <span style="color:#f92672">=</span> frida<span style="color:#f92672">.</span>attach(<span style="color:#e6db74">&#34;hello&#34;</span>)
script <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>create_script(<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Interceptor.attach(ptr(&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;), {
</span><span style="color:#e6db74">    onEnter: function(args) {
</span><span style="color:#e6db74">        send(args[0].toInt32());
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">});
</span><span style="color:#e6db74">&#34;&#34;&#34;</span> <span style="color:#f92672">%</span> int(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">16</span>))
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_message</span>(message, data):
    <span style="color:#66d9ef">print</span>(message)
script<span style="color:#f92672">.</span>on(<span style="color:#960050;background-color:#1e0010">‘</span>message<span style="color:#960050;background-color:#1e0010">’</span>, on_message)
script<span style="color:#f92672">.</span>load()
sys<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>read()
</code></pre></div><h3 id="by-symbol-1">By symbol</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rand_range</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;rand_range&#34;</span>);

<span style="color:#a6e22e">Interceptor</span>.<span style="color:#a6e22e">attach</span>(<span style="color:#a6e22e">rand_range</span>, {
    <span style="color:#a6e22e">onEnter</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">args</span>) {
        <span style="color:#75715e">// Replace with string
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#a6e22e">allocUtf8String</span>(<span style="color:#e6db74">&#34;Frida sleep! :D\n&#34;</span>);
        <span style="color:#75715e">// Replace with int
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NativePointer</span>(<span style="color:#e6db74">&#34;0x1&#34;</span>) <span style="color:#75715e">// or ptr(&#34;0x1&#34;)
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">// Update the value
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">arg1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>];
    },
    <span style="color:#a6e22e">onLeave</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">retval</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">retval</span>);
        <span style="color:#a6e22e">retval</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">arg1</span>);
    }
});
</code></pre></div><h2 id="remote-execution-debugging">Remote execution (debugging)</h2>
<blockquote>
<p>Proptip: Just add <code>-H</code> or <code>-R</code> if you want to use remote mode with default settings or you want to provide remote connection details</p>
</blockquote>
<ul>
<li><a href="#frida-server-remote">frida-server</a></li>
<li><a href="#frida-gadget-remote">frida-gadget</a></li>
</ul>
<h2 id="tools">Tools</h2>
<h3 id="frida-cli">frida CLI</h3>
<p>Open binary with <code>frida &lt;exec&gt;</code> command and play with it in interactive shell session.</p>
<h3 id="frida-server-remote">frida-server (remote)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># on victim</span>
frida-server -l 0.0.0.0:1337

<span style="color:#75715e"># on local client</span>
frida-ps -H $IP:$PORT -R
frida -H $IP:$PORT $proc_name
</code></pre></div><h3 id="frida-gadget-remote">frida-gadget (remote)</h3>
<p>Loaded apps are <strong>paused</strong> (can be changed), common ways of injecting gadget:</p>
<ul>
<li>load with LD_PRELOAD</li>
<li>load with patchelf</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># on victim</span>
LD_PRELOAD<span style="color:#f92672">=</span>./frida-gadget.so ./crypt

<span style="color:#75715e"># on analysis machine</span>
frida-ps -R <span style="color:#75715e"># should yield gadget process</span>
frida -R Gadget
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># on victim</span>
$ patchelf --add-needed ../frida-gadget.so crypt

<span style="color:#75715e"># on analysis machine</span>
$ ./crypt
<span style="color:#f92672">[</span>Frida INFO<span style="color:#f92672">]</span> Listening on 127.0.0.1 TCP port <span style="color:#ae81ff">27042</span>
</code></pre></div><p>Configure with <code>frida-gadget.config</code> (default):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;interaction&#34;</span>: {
    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;listen&#34;</span>,
    <span style="color:#f92672">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">27042</span>,
    <span style="color:#f92672">&#34;on_load&#34;</span>: <span style="color:#e6db74">&#34;resume&#34;</span>
  }
}
</code></pre></div><p>Scripting:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;interaction&#34;</span>: {
    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;script&#34;</span>,
    <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/root/code/embedded-agent.js&#34;</span>
  }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPinPtr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;test_pin&#34;</span>);
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">testPin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NativeFunction</span>(<span style="color:#a6e22e">testPinPtr</span>, <span style="color:#e6db74">&#34;int&#34;</span>, [<span style="color:#e6db74">&#34;pointer&#34;</span>]);

<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">9999</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Trying: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#a6e22e">allocUtf8String</span>(<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPin</span>(<span style="color:#a6e22e">pin</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Pin is: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">toString</span>());
        <span style="color:#66d9ef">break</span>;
    }
}
</code></pre></div><h3 id="frida-trace">frida-trace</h3>
<ol>
<li>Select function to trace</li>
<li>Edit desired function behaviour
<ol>
<li>Open <code>__hooks__</code> directory</li>
<li>edit scripts there</li>
</ol>
</li>
<li>Run &amp; watch new injected behaviour</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">  <span style="color:#a6e22e">onEnter</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">log</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">state</span>) {
    <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">ptr</span>(<span style="color:#e6db74">&#39;1337&#39;</span>);
    <span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;printf(&#39;</span> <span style="color:#f92672">+</span>
      <span style="color:#e6db74">&#39;format=&#34;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">readUtf8String</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#34;&#39;</span> <span style="color:#f92672">+</span>
    <span style="color:#e6db74">&#39;)&#39;</span>);
  },
</code></pre></div><h2 id="examples">Examples</h2>
<h3 id="spawn-web-server">Spawn web server</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">log</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./logger&#34;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">http</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;http&#34;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">testPinPtr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DebugSymbol</span>.<span style="color:#a6e22e">getFunctionByName</span>(<span style="color:#e6db74">&#34;test_pin&#34;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">testPin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NativeFunction</span>(<span style="color:#a6e22e">testPinPtr</span>, <span style="color:#e6db74">&#34;int&#34;</span>, [<span style="color:#e6db74">&#34;pointer&#34;</span>]);

<span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">testPin</span>: <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">p</span>: <span style="color:#66d9ef">string</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Memory</span>.<span style="color:#a6e22e">allocUtf8String</span>(<span style="color:#a6e22e">p</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">testPin</span>(<span style="color:#a6e22e">pin</span>);
    },
    <span style="color:#a6e22e">httpServer</span>: <span style="color:#66d9ef">function</span>() {
        <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">createServer</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) <span style="color:#f92672">=&gt;</span> {
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pin</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#f92672">?</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">check</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">testPin</span>(<span style="color:#a6e22e">pin</span>);

            <span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Request to check </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> returned </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">check</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);

            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">check</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
                <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">writeHead</span>(<span style="color:#ae81ff">200</span>, {<span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;text/plain&#39;</span>});
                <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">write</span>(<span style="color:#e6db74">`Welcome!</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">n`</span>);
            } <span style="color:#66d9ef">else</span> {
                <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">writeHead</span>(<span style="color:#ae81ff">401</span>, {<span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;text/plain&#39;</span>});
                <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">write</span>(<span style="color:#e6db74">`Wrong PIN</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">n`</span>);
            }

            <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>();
        }).<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">1337</span>);
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> frida
<span style="color:#f92672">import</span> sys

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;frida-agent-example/_agent.js&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> f:
    agent <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()

session <span style="color:#f92672">=</span> frida<span style="color:#f92672">.</span>attach(<span style="color:#e6db74">&#34;crypt&#34;</span>)
script <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>create_script(agent)
script<span style="color:#f92672">.</span>load()

api <span style="color:#f92672">=</span> script<span style="color:#f92672">.</span>exports
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;starting HTTP server...&#34;</span>)
api<span style="color:#f92672">.</span>http_server()

<span style="color:#75715e"># keep the server alive now</span>
sys<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>read()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">npm run build <span style="color:#75715e"># or watch</span>
</code></pre></div><h2 id="references">References</h2>
<ul>
<li><a href="https://frida.re">https://frida.re</a></li>
<li><a href="https://github.com/leonjza/frida-boot">https://github.com/leonjza/frida-boot</a></li>
</ul>
            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/tools/binary-analysis">tools/binary-analysis</a></span><span class="tag"><a href="/tags/cheatsheet">cheatsheet</a></span><span class="tag"><a href="/tags/frida">frida</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>724 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-07-26 15:25 &#43;0200</p>
        </div>
        <hr />
        <div id="sharebuttons" class="thin">
            <script>document.write('<a href="https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(document.URL)+'"target="_blank"title="Facebook"style="display:inline-block;vertical-align:middle;width:2em;height:2em;border-radius:10%;background:#3b5998;"><svg style="display:block;fill:#fff;height:44%;margin:28% auto;" viewBox="0 -256 864 1664"><path transform="matrix(1,0,0,-1,-95,1280)" d="M 959,1524 V 1260 H 802 q -86,0 -116,-36 -30,-36 -30,-108 V 927 H 949 L 910,631 H 656 V -128 H 350 V 631 H 95 v 296 h 255 v 218 q 0,186 104,288.5 104,102.5 277,102.5 147,0 228,-12 z" /></svg></a> <a href="https://twitter.com/share?url='+encodeURIComponent(document.URL)+'&text='+encodeURIComponent(document.title)+'"target="_blank"title="Twitter"style="display:inline-block;vertical-align:middle;width:2em;height:2em;border-radius:10%;background:#1b95e0;"><svg style="display:block;fill:#fff;height:36%;margin:32% auto;" viewBox="0 -256 1576 1280"><path transform="matrix(1,0,0,-1,-44,1024)" d="m 1620,1128 q -67,-98 -162,-167 1,-14 1,-42 0,-130 -38,-259.5 Q 1383,530 1305.5,411 1228,292 1121,200.5 1014,109 863,54.5 712,0 540,0 269,0 44,145 q 35,-4 78,-4 225,0 401,138 -105,2 -188,64.5 -83,62.5 -114,159.5 33,-5 61,-5 43,0 85,11 Q 255,532 181.5,620.5 108,709 108,826 v 4 q 68,-38 146,-41 -66,44 -105,115 -39,71 -39,154 0,88 44,163 Q 275,1072 448.5,982.5 622,893 820,883 q -8,38 -8,74 0,134 94.5,228.5 94.5,94.5 228.5,94.5 140,0 236,-102 109,21 205,78 -37,-115 -142,-178 93,10 186,50 z" /></svg></a> <a href="https://www.reddit.com/submit?url='+encodeURIComponent(document.URL)+'&title='+encodeURIComponent(document.title)+'"target="_blank"title="Reddit"style="display:inline-block;vertical-align:middle;width:2em;height:2em;border-radius:10%;background:#ff4500;"><svg style="display:block;fill:#fff;height:46%;margin:26% auto;" viewBox="0 -256 1792 1692"><path transform="matrix(1,0,0,-1,0,1280)" d="m 1792,690 q 0,-58 -29,-105.5 -30,-47.5 -80,-72.5 12,-46 12,-96 0,-155 -106,-287 Q 1482,-3 1298,-79.5 1114,-156 898,-156 682,-156 498.5,-79.5 315,-3 208.5,129 102,261 102,416 q 0,47 11,94 Q 62,535 31,583.5 0,632 0,690 q 0,82 58,140.5 58,58.5 141,58.5 85,0 145,-63 218,152 515,162 l 116,521 q 3,13 15,21 12,8 26,5 l 369,-81 q 18,37 54,60 36,22 79,22 62,0 106,-43 44,-44 44,-106 0,-62 -44,-106 -44,-44 -106,-44 -62,0 -105,44 -44,43 -44,105 l -334,74 -104,-472 q 300,-9 519,-160 58,61 143,61 83,0 141,-58.5 58,-58.5 58,-140.5 z M 418,491 q 0,-62 43.5,-106 43.5,-44 105.5,-44 62,0 106,44 44,44 44,106 0,62 -44,105.5 Q 629,640 567,640 506,640 462,596 418,552 418,491 z m 810,-355 q 11,11 11,26 0,15 -11,26 -10,10 -25,10 -15,0 -26,-10 -41,-42 -121,-62 -80,-20 -160,-20 -80,0 -160,20 -80,20 -121,62 -11,10 -26,10 -15,0 -25,-10 Q 553,178 553,162.5 553,147 564,136 607,93 682.5,68 758,43 805,38.5 852,34 896,34 q 44,0 91,4.5 47,4.5 123,29.5 75,25 118,68 z m -3,205 q 62,0 106,44 43,44 43,106 0,61 -44,105 -44,44 -105,44 -62,0 -106,-43.5 -44,-43.5 -44,-105.5 0,-62 44,-106 44,-44 106,-44 z" /></svg></a> <a href="https://www.tumblr.com/widgets/share/tool?canonicalUrl='+encodeURIComponent(document.URL)+'&title='+encodeURIComponent(document.title)+'&caption='+encodeURIComponent(document.querySelector('meta[name=description]')?document.querySelector('meta[name=description]').content:'')+'"target="_blank"title="Tumblr"style="display:inline-block;vertical-align:middle;width:2em;height:2em;border-radius:10%;background:#39455f;"><svg style="display:block;fill:#fff;height:44%;margin:28% auto;" viewBox="0 -256 956 1664"><path transform="matrix(1,0,0,-1,-68,1280)" d="m 944,207 80,-237 q -23,-35 -111,-66 -88,-31 -177,-32 -104,-2 -190.5,26 Q 459,-74 403,-28 347,18 308,78 269,138 252.5,198 236,258 236,316 V 860 H 68 v 215 q 72,26 129,70 57,43 91,90 34,46 58,102 24,55 34,99 10,43 15,88 1,5 4.5,9 3.5,3 7.5,3 H 651 V 1112 H 984 V 860 H 650 V 342 q 0,-30 6.5,-56 Q 663,260 679,233.5 695,207 728.5,192 762,177 810,178 q 78,2 134,29 z" /></svg></a> <a href="https://plus.google.com/share?url='+encodeURIComponent(document.URL)+'"target="_blank"title="Google+"style="display:inline-block;vertical-align:middle;width:2em;height:2em;border-radius:10%;background:#dd4b39;"><svg style="display:block;fill:#fff;height:38%;margin:31% auto;" viewBox="0 -256 2304 1466"><path transform="matrix(1,0,0,-1,0,1117)" d="M 1437,623 Q 1437,415 1350,252.5 1263,90 1102,-1.5 941,-93 733,-93 584,-93 448,-35 312,23 214,121 116,219 58,355 0,491 0,640 q 0,149 58,285 58,136 156,234 98,98 234,156 136,58 285,58 286,0 491,-192 L 1025,990 Q 908,1103 733,1103 610,1103 505.5,1041 401,979 340,872.5 279,766 279,640 279,514 340,407.5 401,301 505.5,239 610,177 733,177 q 83,0 152.5,23 69.5,23 114.5,57.5 45,34.5 78.5,78.5 33.5,44 49,83 15.5,39 21.5,74 H 733 v 252 h 692 q 12,-63 12,-122 z m 867,122 V 535 H 2095 V 326 h -210 v 209 h -209 v 210 h 209 v 209 h 210 V 745 h 209 z" /></svg></a>');</script>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="/posts/0-frida-playgrounds/">
                                <span class="button__icon">←</span>
                                <span class="button__text">[0x0] FRIDA Playground</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="/posts/nothing-is-lost-in-the-internet/">
                                <span class="button__text">Nothing Is Lost in the Internet</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
            <div id="comments" class="thin">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "trib0r3s-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="/">trib0r3</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">CC BY 4.0</a></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4a69500057d68129e88f497d354afe68422eb56de6d15e45dbe2190858ea5a76bfcb096406f992984b241db45f47388ac57ab0376e3b32125bef7a8a6d0f06c4.js" integrity="sha512-SmlQAFfWgSnoj0l9NUr&#43;aEIutW3m0V5F2&#43;IZCFjqWna/ywlkBvmSmEskHbRfRziKxXqwN247MhJb73qKbQ8GxA=="></script>



    </body>
</html>
